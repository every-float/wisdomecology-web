<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
        <script type="text/javascript" src="../../common/commonCss.js"></script>
        <script type="text/javascript" src="../../common/commonUrl.js"></script>
        <script type="text/javascript" src="../../common/commonJs.js"></script>
        <style>
            .layui-table-link{
                width: 100%;
                height: 100%;
                display: block;
                text-align: center;
            }
        </style>
        <title>统计</title>
    </head>
    <body>
        <div id="app" v-cloak>
            <div class="layui-fluid">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <!-- 表格工具栏 -->
                        <form class="layui-form toolbar">
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <div class="layui-input-inline">
                                        <input name="time" class="layui-input icon-date" placeholder="选择时间"/>
                                    </div>
                                </div>
                                <div class="layui-inline" style="width:100px;">
                                    <div class="layui-input-inline" style="width:100%;">
                                        <select name="index" lay-filter="index">
                                            <option v-for="(item, index) in index_list" :key="index" :value="item.value">{{item.key}}</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <div class="layui-input-inline">
                                        <span id="dialogBtn13" class="layui-btn layui-btn-primary icon-btn">
                                            &nbsp;站点 <i class="layui-icon layui-icon-drop"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="layui-inline">&emsp;
                                    <a class="layui-btn icon-btn" lay-filter="loginRecordTbSearch" lay-submit>
                                        <i class="layui-icon">&#xe615;</i>搜索
                                    </a>
                                </div>

                            </div>
                        </form>

                        <!-- 数据表格 -->
                        <table id="loginRecordTable" lay-filter="loginRecordTable"></table>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/html" id="hour_00_Tpl">
            <div style="background: {{d['00_more'].bgcolor}};color: {{d['00_more'].color}};" class="layui-table-link">
                {{d['00']}}
            </div>
        </script>
        <script type="text/html" id="hour_01_Tpl">
            <div style="background: {{d['01_more'].bgcolor}};color: {{d['01_more'].color}};" class="layui-table-link">
                {{d['01']}}
            </div>
        </script>
        <script type="text/html" id="hour_02_Tpl">
            <div style="background: {{d['02_more'].bgcolor}};color: {{d['02_more'].color}};" class="layui-table-link">
                {{d['02']}}
            </div>
        </script>
        <script type="text/html" id="hour_03_Tpl">
            <div style="background: {{d['03_more'].bgcolor}};color: {{d['03_more'].color}};" class="layui-table-link">
                {{d['03']}}
            </div>
        </script>
        <script type="text/html" id="hour_04_Tpl">
            <div style="background: {{d['04_more'].bgcolor}};color: {{d['04_more'].color}};" class="layui-table-link">
                {{d['04']}}
            </div>
        </script>
        <script type="text/html" id="hour_05_Tpl">
            <div style="background: {{d['05_more'].bgcolor}};color: {{d['05_more'].color}};" class="layui-table-link">
                {{d['05']}}
            </div>
        </script>
        <script type="text/html" id="hour_06_Tpl">
            <div style="background: {{d['06_more'].bgcolor}};color: {{d['06_more'].color}};" class="layui-table-link">
                {{d['06']}}
            </div>
        </script>
        <script type="text/html" id="hour_07_Tpl">
            <div style="background: {{d['07_more'].bgcolor}};color: {{d['07_more'].color}};" class="layui-table-link">
                {{d['07']}}
            </div>
        </script><script type="text/html" id="hour_08_Tpl">
            <div style="background: {{d['08_more'].bgcolor}};color: {{d['08_more'].color}};" class="layui-table-link">
                {{d['08']}}
            </div>
        </script>

        <script type="text/html" id="hour_09_Tpl">
            <div style="background: {{d['09_more'].bgcolor}};color: {{d['09_more'].color}};" class="layui-table-link">
                {{d['09']}}
            </div>
        </script>
        <script type="text/html" id="hour_10_Tpl">
            <div style="background: {{d['10_more'].bgcolor}};color: {{d['10_more'].color}};" class="layui-table-link">
                {{d['10']}}
            </div>
        </script>
        <script type="text/html" id="hour_11_Tpl">
            <div style="background: {{d['11_more'].bgcolor}};color: {{d['11_more'].color}};" class="layui-table-link">
                {{d['11']}}
            </div>
        </script>
        <script type="text/html" id="hour_12_Tpl">
            <div style="background: {{d['12_more'].bgcolor}};color: {{d['12_more'].color}};" class="layui-table-link">
                {{d['12']}}
            </div>
        </script>
        <script type="text/html" id="hour_13_Tpl">
            <div style="background: {{d['13_more'].bgcolor}};color: {{d['13_more'].color}};" class="layui-table-link">
                {{d['13']}}
            </div>
        </script>
        <script type="text/html" id="hour_14_Tpl">
            <div style="background: {{d['14_more'].bgcolor}};color: {{d['14_more'].color}};" class="layui-table-link">
                {{d['14']}}
            </div>
        </script>
        <script type="text/html" id="hour_15_Tpl">
            <div style="background: {{d['15_more'].bgcolor}};color: {{d['15_more'].color}};" class="layui-table-link">
                {{d['15']}}
            </div>
        </script>
        <script type="text/html" id="hour_16_Tpl">
            <div style="background: {{d['16_more'].bgcolor}};color: {{d['16_more'].color}};" class="layui-table-link">
                {{d['16']}}
            </div>
        </script>
        <script type="text/html" id="hour_17_Tpl">
            <div style="background: {{d['17_more'].bgcolor}};color: {{d['17_more'].color}};" class="layui-table-link">
                {{d['17']}}
            </div>
        </script>
        <script type="text/html" id="hour_18_Tpl">
            <div style="background: {{d['18_more'].bgcolor}};color: {{d['18_more'].color}};" class="layui-table-link">
                {{d['18']}}
            </div>
        </script>
        <script type="text/html" id="hour_19_Tpl">
            <div style="background: {{d['19_more'].bgcolor}};color: {{d['19_more'].color}};" class="layui-table-link">
                {{d['19']}}
            </div>
        </script>
        <script type="text/html" id="hour_20_Tpl">
            <div style="background: {{d['20_more'].bgcolor}};color: {{d['20_more'].color}};" class="layui-table-link">
                {{d['20']}}
            </div>
        </script>
        <script type="text/html" id="hour_21_Tpl">
            <div style="background: {{d['21_more'].bgcolor}};color: {{d['21_more'].color}};" class="layui-table-link">
                {{d['21']}}
            </div>
        </script>
        <script type="text/html" id="hour_22_Tpl">
            <div style="background: {{d['22_more'].bgcolor}};color: {{d['22_more'].color}};" class="layui-table-link">
                {{d['22']}}
            </div>
        </script>
        <script type="text/html" id="hour_23_Tpl">
            <div style="background: {{d['23_more'].bgcolor}};color: {{d['23_more'].color}};" class="layui-table-link">
                {{d['23']}}
            </div>
        </script>
    </body>
</html>
<script>
    if('vue'){
        var vm = new Vue({
          el:"#app",
          data:{
            list:[],
            index_list:[],
            currentIndex:'AQI',
            time:'',
          },
          methods:{
            fnDataMore:function(value){
                 var result={
                     bgcolor:'',
                     color:'',
                     level:''
                 };
                 switch (vm.currentIndex.toLowerCase()) {
                     case 'aqi':
                         if(value!=''){
                            if(value<=50){
                                result.bgcolor='rgb(0,228,0)';
                                result.color='white';
                                result.level='优';
                            }else if(50<value&&value<=100){
                                result.bgcolor='rgb(255,255,0)';
                                result.color='black';
                                result.level='良';
                            }else if(100<value&&value<=150){
                                result.bgcolor='rgb(255,126,0)';
                                result.color='white';
                                result.level='轻度';
                            }else if(150<value&&value<=200){
                                result.bgcolor='rgb(255,0,0)';
                                result.color='white';
                                result.level='中度';
                            }else if(200<value&&value<=300){
                                result.bgcolor='rgb(153,0,76)';
                                result.color='white';
                                result.level='重度';
                            }else if(300<value){
                                result.bgcolor='rgb(126,0,35)';
                                result.color='white';
                                result.level='严重';
                            }
                         }else{
                            result.bgcolor='';
                            result.color='';
                            result.level='';
                         }
                         break;
                     case 'so2':
                         if(value!=''){
                            if(value<=150){
                                result.bgcolor='rgb(0,228,0)';
                                result.color='white';
                                result.level='优';
                            }else if(150<value&&value<=500){
                                result.bgcolor='rgb(255,255,0)';
                                result.color='black';
                                result.level='良';
                            }else if(500<value&&value<=650){
                                result.bgcolor='rgb(255,126,0)';
                                result.color='white';
                                result.level='轻度';
                            }else if(650<value&&value<=800){
                                result.bgcolor='rgb(255,0,0)';
                                result.color='white';
                                result.level='中度';
                            }else{
                                result.bgcolor='rgb(0,228,0)';
                                result.color='white';
                                result.level='重度';
                            }
                         }else{
                            result.bgcolor='';
                            result.color='';
                            result.level='';
                         }
                         break;
                     case 'no2':
                         if(value!=''){
                            if(value<=100){
                                result.bgcolor='rgb(0,228,0)';
                                result.color='white';
                                result.level='优';
                            }else if(100<value&&value<=200){
                                result.bgcolor='rgb(255,255,0)';
                                result.color='black';
                                result.level='良';
                            }else if(200<value&&value<=700){
                                result.bgcolor='rgb(255,126,0)';
                                result.color='white';
                                result.level='轻度';
                            }else if(700<value&&value<=1200){
                                result.bgcolor='rgb(255,0,0)';
                                result.color='white';
                                result.level='中度';
                            }else if(1200<value&&value<=2340){
                                result.bgcolor='rgb(153,0,76)';
                                result.color='white';
                                result.level='重度';
                            }else if(2340<value){
                                result.bgcolor='rgb(126,0,35)';
                                result.color='white';
                                result.level='严重';
                            }
                         }else{
                            result.bgcolor='';
                            result.color='';
                            result.level='';
                         }
                         break;
                     case 'pm25':
                         if(value!=''){
                            if(value<=35){
                                result.bgcolor='rgb(0,228,0)';
                                result.color='white';
                                result.level='优';
                            }else if(35<value&&value<=75){
                                result.bgcolor='rgb(255,255,0)';
                                result.color='black';
                                result.level='良';
                            }else if(75<value&&value<=115){
                                result.bgcolor='rgb(255,126,0)';
                                result.color='white';
                                result.level='轻度';
                            }else if(115<value&&value<=150){
                                result.bgcolor='rgb(255,0,0)';
                                result.color='white';
                                result.level='中度';
                            }else if(150<value&&value<=250){
                                result.bgcolor='rgb(153,0,76)';
                                result.color='white';
                                result.level='重度';
                            }else if(250<value){
                                result.bgcolor='rgb(126,0,35)';
                                result.color='white';
                                result.level='严重';
                            }
                         }else{
                            result.bgcolor='';
                            result.color='';
                            result.level='';
                         }
                         break;
                     case 'pm10':
                         if(value!=''){
                            if(value<=50){
                                result.bgcolor='rgb(0,228,0)';
                                result.color='white';
                                result.level='优';
                            }else if(50<value&&value<=150){
                                result.bgcolor='rgb(255,255,0)';
                                result.color='black';
                                result.level='良';
                            }else if(150<value&&value<=250){
                                result.bgcolor='rgb(255,126,0)';
                                result.color='white';
                                result.level='轻度';
                            }else if(250<value&&value<=350){
                                result.bgcolor='rgb(255,0,0)';
                                result.color='white';
                                result.level='中度';
                            }else if(350<value&&value<=420){
                                result.bgcolor='rgb(153,0,76)';
                                result.color='white';
                                result.level='重度';
                            }else if(420<value){
                                result.bgcolor='rgb(126,0,35)';
                                result.color='white';
                                result.level='严重';
                            }
                         }else{
                            result.bgcolor='';
                            result.color='';
                            result.level='';
                         }
                         break;
                     case 'co':
                         if(value!=''){
                            if(value<=5){
                                result.bgcolor='rgb(0,228,0)';
                                result.color='white';
                                result.level='优';
                            }else if(5<value&&value<=10){
                                result.bgcolor='rgb(255,255,0)';
                                result.color='black';
                                result.level='良';
                            }else if(10<value&&value<=35){
                                result.bgcolor='rgb(255,126,0)';
                                result.color='white';
                                result.level='轻度';
                            }else if(35<value&&value<=60){
                                result.bgcolor='rgb(255,0,0)';
                                result.color='white';
                                result.level='中度';
                            }else if(60<value&&value<=90){
                                result.bgcolor='rgb(153,0,76)';
                                result.color='white';
                                result.level='重度';
                            }else if(90<value){
                                result.bgcolor='rgb(126,0,35)';
                                result.color='white';
                                result.level='严重';
                            }
                         }else{
                            result.bgcolor='';
                            result.color='';
                            result.level='';
                         }
                         
                         break;
                     case 'o3':
                         if(value!=''){
                            if(value<=160){
                                result.bgcolor='rgb(0,228,0)';
                                result.color='white';
                                result.level='优';
                            }else if(160<value&&value<=200){
                                result.bgcolor='rgb(255,255,0)';
                                result.color='black';
                                result.level='良';
                            }else if(200<value&&value<=300){
                                result.bgcolor='rgb(255,126,0)';
                                result.color='white';
                                result.level='轻度';
                            }else if(300<value&&value<=400){
                                result.bgcolor='rgb(255,0,0)';
                                result.color='white';
                                result.level='中度';
                            }else if(400<value&&value<=800){
                                result.bgcolor='rgb(153,0,76)';
                                result.color='white';
                                result.level='重度';
                            }else if(800<value){
                                result.bgcolor='rgb(126,0,35)';
                                result.color='white';
                                result.level='严重';
                            }
                         }else{
                            result.bgcolor='';
                            result.color='';
                            result.level='';
                         }
                         break;
                     case 'o38h':
                         if(value!=''){
                            if(value<=160){
                                result.bgcolor='rgb(0,228,0)';
                                result.color='white';
                                result.level='优';
                            }else if(160<value&&value<=200){
                                result.bgcolor='rgb(255,255,0)';
                                result.color='black';
                                result.level='良';
                            }else if(200<value&&value<=300){
                                result.bgcolor='rgb(255,126,0)';
                                result.color='white';
                                result.level='轻度';
                            }else if(300<value&&value<=400){
                                result.bgcolor='rgb(255,0,0)';
                                result.color='white';
                                result.level='中度';
                            }else if(400<value&&value<=800){
                                result.bgcolor='rgb(153,0,76)';
                                result.color='white';
                                result.level='重度';
                            }else if(800<value){
                                result.bgcolor='rgb(126,0,35)';
                                result.color='white';
                                result.level='严重';
                            }
                         }else{
                            result.bgcolor='';
                            result.color='';
                            result.level='';
                         }
                         break;
                 }
                return result;
            },
          }
        });
    }
    var insTb=null;
    layui.use(['layer', 'form', 'admin',  'table', 'util', 'dropdown', 'laydate'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var form = layui.form;
        var table = layui.table;
        var util = layui.util;
        var admin = layui.admin;
        var laydate = layui.laydate;

        vm.time=dateFormat(new Date(), 'yyyy-MM-dd');
        laydate.render({
            elem: 'input[name="time"]',
            type: 'date',
            value: new Date(),
            trigger: 'click',
            done: function(value, date, endDate){
                vm.time=value;
            }
        });

        form.on('select(index)', function(data){
             vm.currentIndex=data.value;
        })

        form.on('submit(loginRecordTbSearch)', function (data) {
            fn_getData();
            return false;
        });

        axios.all([fnGetSiteList(), fnGetIndexList()])
            .then(axios.spread(function(res1, res2) {
                if(res1.status==200){
                    vm.index_list=res1.data;
                }
                if(res2.status==200){
                    var site_list=res2.data;
                    for (var i = 0; i < site_list.length; i++) {
                        if(site_list[i].pid==0){
                            vm.list.push(site_list[i]);
                        }
                    }
                    for (var i = 0; i < vm.list.length; i++) {
                        var children=[];
                        for (var j = 0; j < site_list.length; j++) {
                            if(vm.list[i].sid==site_list[j].pid){
                                var item=site_list[j];
                                if(i==0){
                                    item.LAY_CHECKED=true;
                                }else{
                                    item.LAY_CHECKED=false;
                                }
                                children.push(item);
                            }
                        }
                        vm.list[i]['children']=children;
                    }
                }
                vm.$nextTick(function(){
                    form.render();
                    fn_getData();
                });
            })
        );

        function fnGetSiteList(){
            return axios({
                method: 'get',
                url: baseUrl + 'dq/point/getIndex',
            });
        }

        function fnGetIndexList(){
            return axios({
                method: 'get',
                url: baseUrl + 'dq/point/getPointTree',
            });
        }

        function fn_getData(){
            if('准备查询参数'){
                var ids=[];
                for (var i = 0; i < vm.list.length; i++) {
                    var itemI=vm.list[i];
                    for (var j = 0; j < itemI['children'].length; j++) {
                        var itemJ=itemI['children'][j];
                        if(itemJ.LAY_CHECKED){
                            ids.push(itemJ.sid);
                        }
                    }
                }
            }
            let param = new URLSearchParams()
            param.append('ids', ids.join(','));
            param.append('time', vm.time);
            param.append('index', vm.currentIndex);
            axios({
                method: 'post',
                url: baseUrl + 'dq/statistic/getDataByDay',
                headers: {
                    'Authorization': 'Bearer ' + $.cookie('login_sid_t_we'),
                },
                data: param
            }).then(function(res) {
                if ( res.data.code == 0 ) {
                    fn_initTable(res.data.data);
                }
            });
        }

        /* 渲染表格 */
        function fn_initTable(list){
            $.each(list, function(index, item){
                 for (var i = 0; i < 24; i++) {
                     var hour=formatZero(i,2)+'';
                     item[hour+'_more']=vm.fnDataMore(item[hour]);
                 }
            });
            console.log(list)
            insTb = table.render({
                elem: '#loginRecordTable',
                data: list,
                page: false,
                limit:99999,
                cellMinWidth: 80,
                height: 'full-100',
                cols: [[
                    {type: 'checkbox', fixed: 'left'},
                    {field: 'name', title: '名称', width:200, fixed: 'left'},
                    {field: '00', title: '00', align: 'center',  templet: '#hour_00_Tpl'},
                    {field: '01', title: '01', align: 'center',  templet: '#hour_01_Tpl'},
                    {field: '02', title: '02', align: 'center',  templet: '#hour_02_Tpl'},
                    {field: '03', title: '03', align: 'center',  templet: '#hour_03_Tpl'},
                    {field: '04', title: '04', align: 'center',  templet: '#hour_04_Tpl'},
                    {field: '05', title: '05', align: 'center',  templet: '#hour_05_Tpl'},
                    {field: '06', title: '06', align: 'center',  templet: '#hour_06_Tpl'},
                    {field: '07', title: '07', align: 'center',  templet: '#hour_07_Tpl'},
                    {field: '08', title: '08', align: 'center',  templet: '#hour_08_Tpl'},
                    {field: '09', title: '09', align: 'center',  templet: '#hour_09_Tpl'},
                    {field: '10', title: '10', align: 'center',  templet: '#hour_10_Tpl'},
                    {field: '11', title: '11', align: 'center',  templet: '#hour_11_Tpl'},
                    {field: '12', title: '12', align: 'center',  templet: '#hour_12_Tpl'},
                    {field: '13', title: '13', align: 'center',  templet: '#hour_13_Tpl'},
                    {field: '14', title: '14', align: 'center',  templet: '#hour_14_Tpl'},
                    {field: '15', title: '15', align: 'center',  templet: '#hour_15_Tpl'},
                    {field: '16', title: '16', align: 'center',  templet: '#hour_16_Tpl'},
                    {field: '17', title: '17', align: 'center',  templet: '#hour_17_Tpl'},
                    {field: '18', title: '18', align: 'center',  templet: '#hour_18_Tpl'},
                    {field: '19', title: '19', align: 'center',  templet: '#hour_19_Tpl'},
                    {field: '20', title: '20', align: 'center',  templet: '#hour_20_Tpl'},
                    {field: '21', title: '21', align: 'center',  templet: '#hour_21_Tpl'},
                    {field: '22', title: '22', align: 'center',  templet: '#hour_22_Tpl'},
                    {field: '23', title: '23', align: 'center',  templet: '#hour_23_Tpl'},
                ]]
            });
        }


        // iframe形式弹窗传值
        $('#dialogBtn13').click(function () {
            var layIndex = admin.open({
                type: 2,
                title: '站点选择',
                closeBtn:0,
                content: 'site_select.html',
                area: ['800px', '90%'],
                fixed: true,
                offset: 'auto',
                data: {
                    list:vm.list,
                    type:'checkbox'
                },
                end: function () {  // 监听弹窗关闭
                    if (admin.getLayerData(layIndex, 'list')) {  // 判断表单操作成功标识
                        vm.list=admin.getLayerData(layIndex, 'list');
                    }
                }
            });
        });
    });



</script>